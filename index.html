<html>
    <head>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
        <script type="text/javascript" src="vis.min.js"></script>
        <link href="vis.min.css" rel="stylesheet" type="text/css" />
        <meta charset="utf-8">

        <style>
            #grafo {
                border: solid 1px black;
                width: 90%;
                height: 90%;
                margin: 0 auto;
            }
            body {
                text-align: center;
                align-content: center;
            }
        </style>

    </head>
    <body>
        <h1>FIUBA-Map</h1>
        <h2>Descripcion</h2>
        <p>Darle un ratito para que cargue!</p>
        <p>Ver plan de estudio</p>
        <p>Clusters de optativas y demas o when zooming</p>
        <div id="grafo"></div>
        <p>Aclaraciones: washu washu un solo idioma. washu washu usar la ruedita. washu washu tesis y tp</p>
        <p>Link a github</p>
        <p>75.61,Taller de Programación III,6,66.74-75.74,Orientacion: Gestion Industrial de Sistemas (opción tesis)</p>
    </body>
    <script type="text/javascript">
        $.ajax({
            url: 'data/informatica-1986.csv',
            dataType: 'text',
            success: function(data, jqXHR, textStatus) {graphFromCSV(data)}
        })

        function specialAttrs(codigo){
            if (codigo == 'Ciclo Básico Común') {return {y:-1000}}

        }

        function getNode(rowCells){
            
            var codigo = rowCells[0]
            var materia = rowCells[1]
            var creditos = rowCells[2]
            var correlativas = rowCells[3]
            var categoria = rowCells[4]
            var nivel = rowCells[5]
            var name = '[' + codigo + ']\n ' + materia
            
            if (creditos!=0){name+=' -- ' + creditos + ' créditos'}
            if (categoria.indexOf('x')!==-1){name+= ' -- ' + categoria}

            return {id:codigo, label:materia, title:name, group:categoria, value:creditos, level:nivel,cid:1}
        }

        function graphFromCSV(data) {
            var nodes_arr = new Array()
            var nodes = new vis.DataSet([])
            var edges = new vis.DataSet([])

            var allRows = data.split(/\r?\n|\r/);
            for (var singleRow = 1; singleRow < allRows.length-1; singleRow++) {
                var rowCells = allRows[singleRow].split(',');
                if ($.inArray(rowCells[0],nodes_arr) == -1) {
                    nodes_arr.push(rowCells[0])
                    nodes.add(getNode(rowCells))
                }

                var correlativas = rowCells[3].split('-')
                correlativas.forEach(x => {
                    edges.add({from:x,to:rowCells[0]})
                });
            } 
            
            var container = document.getElementById('grafo');

            var data = {
                nodes: nodes,
                edges: edges
            };

            var options = {
                nodes:{
                    shape:'box'
                },
                layout: {
                    hierarchical: {
                        enabled: true,
                    }
                },
                edges:{
                    arrows: {
                        middle: {enabled: true, scaleFactor:1, type:'arrow'}
                    },
                },
            };

            var network = new vis.Network(container, data, options);          
            
            clusterElectivas = {
                joinCondition:function(nodeOptions) {
                    return nodeOptions.group === 'Materias Electivas';
                },
                clusterNodeProperties: {id: 'ME', shape:'database', label: "Materias Electivas",group:'Materias Electivas', level:7}
            };

            clusterIndustrial = {
                joinCondition:function(nodeOptions) {
                    return nodeOptions.group === 'Orientacion: Gestión Industrial de Sistemas';
                },
                clusterNodeProperties: {id: 'IND', shape:'database', label: "Orientacion: Gestión Industrial de Sistemas",group:'Orientacion: Gestión Industrial de Sistemas', level:8}

            };

            clusterDistribuidos = {
                joinCondition:function(nodeOptions) {
                    return nodeOptions.group === 'Orientacion: Sistemas Distribuidos';
                },
                clusterNodeProperties: {id: 'SD', shape:'database', label: "Orientacion: Sistemas Distribuidos",group:'Orientacion: Sistemas Distribuidos', level:8}
            };

            clusterProduccion = {
                joinCondition:function(nodeOptions) {
                    return nodeOptions.group === 'Orientacion: Sistemas de Producción';
                },
                clusterNodeProperties: {id: 'SP', shape:'database', label: "Orientacion: Sistemas de Producción",group:'Orientacion: Sistemas de Producción', level:8}                
            };

            network.cluster(clusterElectivas);
            network.cluster(clusterIndustrial);
            network.cluster(clusterDistribuidos);
            network.cluster(clusterProduccion);

            network.on("selectNode", function(params) {
                if (params.nodes.length == 1) {
                    if (network.isCluster(params.nodes[0]) == true) {
                        network.openCluster(params.nodes[0]);
                    }
                }
            });
        }
    </script>

</html>